name: static-routing-basics

topology:
  nodes:
    # Router 1 - Left edge router
    r1:
      kind: linux
      image: alpine:latest
      exec:
        - apk add --no-cache iproute2 iputils tcpdump
        - ip addr add 10.1.1.1/24 dev eth1
        - ip addr add 10.1.2.1/24 dev eth2
        - ip route add 10.2.2.0/24 via 10.1.2.2
        - ip route add 10.3.3.0/24 via 10.1.2.2
        - sysctl -w net.ipv4.ip_forward=1

    # Router 2 - Center router
    r2:
      kind: linux
      image: alpine:latest
      exec:
        - apk add --no-cache iproute2 iputils tcpdump
        - ip addr add 10.1.2.2/24 dev eth1
        - ip addr add 10.2.2.2/24 dev eth2
        - ip route add 10.1.1.0/24 via 10.1.2.1
        - ip route add 10.3.3.0/24 via 10.2.2.3
        - sysctl -w net.ipv4.ip_forward=1

    # Router 3 - Right edge router
    r3:
      kind: linux
      image: alpine:latest
      exec:
        - apk add --no-cache iproute2 iputils tcpdump
        - ip addr add 10.2.2.3/24 dev eth1
        - ip addr add 10.3.3.3/24 dev eth2
        - ip route add 10.1.1.0/24 via 10.2.2.2
        - ip route add 10.1.2.0/24 via 10.2.2.2
        - sysctl -w net.ipv4.ip_forward=1

    # PC1 - Left client
    pc1:
      kind: linux
      image: alpine:latest
      exec:
        - apk add --no-cache iproute2 iputils tcpdump
        - ip addr add 10.1.1.10/24 dev eth1
        - ip route add default via 10.1.1.1

    # PC2 - Right client
    pc2:
      kind: linux
      image: alpine:latest
      exec:
        - apk add --no-cache iproute2 iputils tcpdump
        - ip addr add 10.3.3.10/24 dev eth1
        - ip route add default via 10.3.3.3

  links:
    - endpoints: ["r1:eth1", "pc1:eth1"]
    - endpoints: ["r1:eth2", "r2:eth1"]
    - endpoints: ["r2:eth2", "r3:eth1"]
    - endpoints: ["r3:eth2", "pc2:eth1"]
